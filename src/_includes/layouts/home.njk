---
layout: layouts/main.njk
home: true
---
<main role="main">
    <article>
        <h1 class="title leading-none hide-mobile mb2">Welcome</h1>

        <div class="prose stronger">{{ content | safe }}</div>

        <hr />

        <p>My fav track <time title="Updated at {{ current_track.updatedAt | date('yyyy-MM-dd')}}" datetime="{{ current_track.updatedAt }}">at the moment</time> is ♫ <u class="b">{{ current_track.name }}</u> by {{ current_track.artist }}.</p>
    </article>

    <section class="h-feed">
      <header class="flex items-center justify-between">
        <h1 class="p-name">Micro</h1>

        <a href="/micro" class="u-url muted f6" title="Read more">View all</a>
      </header>

      <ol role="list">
      {% for note in search.pages("type=note", "date=desc", 3) %}
          <li class="mb2 pb2 relative border border-b h-entry" id="{{ note.url | url(true) }}">
              <h2 class="font-sans f5 fw4 mb0">
                  <a href="{{ note.url }}" class="muted u-url" title="Permalink"><time class="dt-published" datetime="{{ note.date | tdate('Machine', note.timezone) }}" pubdate>{{ note.date | tdate('HumanTime', note.timezone) }}</time></a>
              </h2>

              <details class="mb0">
                  <summary style="position: absolute; right: 0; top: -0.25rlh" class="btn f5">View</summary>
                  <div class="prose excerpt font-mono f6 mt2 text-color-contrast p-summary">
                      {{ note.content | excerpt | md | safe }}
                  </div>

                  {% if didExcerpt(note.content) %}
                      <p class="mt1 mb0 font-sans">
                          <a href="{{ note.url }}" class="muted f6">Continued ⇢</a>
                      </p>
                  {% endif %}
              </details>
          </li>
      {% endfor %}
      </ol>
    </section>

    <section class="h-feed">
        <header class="flex items-center justify-between">
            <h1 class="p-name">Reading</h1>
            <a href="/reading" class="u-url f6 muted" title="Read more">View all</a>
        </header>

        <ol role="list" class="item-grid">
            {% macro book_item(book, reading=false) %}
            <li class="h-entry mb1">
                <a href="/reading/{{ book.slug }}" class="fw5">{{ book.title }}</a><span>{{ book.author }}</span>
                {% if reading %}<span class="Badge f6">Reading</span>{% endif %}
            </li>
            {% endmacro %}

            {% set current_book = currentBook() %}
            {% if current_book %}
                {{ book_item(current_book, true) }}
            {% endif %}

            {% for book in search.pages("type=book", "finishedAt=desc", 3) %}
                {{ book_item(book) }}
            {% endfor %}
        </ol>
    </section>

    <section class="h-feed">
      <header class="flex items-center justify-between">
        <h1 class="p-name">Writings</h1>

        <a href="/writings" class="u-url muted f6" title="Read more">View all</a>
      </header>

      <ol role="list" class="item-grid">
        {% for post in search.pages("type=post", "date=desc", 3) %}
          <li class="mb1 h-entry" id="{{ post.url | url(true) }}">
          	<a class="u-url fw5" href="{{ post.url }}">{{ post.title }}</a>
           	<time class="dt-published" pubdate datetime="{{ post.date | tdate('Machine', post.timezone) }}">{{ post.date | tdate('HumanDate', post.timezone) }}</time>
          </li>
        {% endfor %}
      </ol>
    </section>

    <section>
    	<header>
            <h1>Listening</h1>
            <p class="font-sans f5 fw4 mb0 muted" id="music-loading">Tracks I've listened to recently.</p>
    	</header>
    	<ol role="list" id="music-target" class="TracksList">

    	</ol>
    </section>
</main>

<template id="music-tmpl">
	<li class="mb2 leading-tight">
		<span class="music-title block fw6"></span>
		<small class="font-sans f6">
			<span class="music-subtitle muted"></span>
		</small>
	</li>
</template>

<script type="module">
	const ENDPOINT = 'https://brookie.pages.dev';

	const render = (target, tracks) => {
		const tmpl = document.getElementById('music-tmpl');
		const fmt = new Intl.DateTimeFormat(undefined, {day: "numeric", month: "short", hour: "numeric", minute: "numeric"});

		for (const track of tracks) {
			const clone = tmpl.content.cloneNode(true);
			const container = clone.querySelector('li')
			const title = clone.querySelector('.music-title')
			const subtitle = clone.querySelector('.music-subtitle');

			title.textContent = track.name;
			subtitle.textContent = `${track.artist['#text']} — ${track.album['#text']}`;

			if (track['@attr']?.nowplaying == 'true') {
				title.classList.add('fw7');
				container.classList.add('border', 'border-b', 'mb2', 'pb2');
				dateTime.textContent = 'Listening now';
				dateTime.classList.add('fw7');
			}
			target.appendChild(clone);
		}
	}

	if ('content' in document.createElement('template')) {
		const target = document.getElementById('music-target');
		const loading = document.getElementById('music-loading');
		const original = loading.textContent;
		loading.textContent = 'Loading…';

		try {
			const res = await fetch(ENDPOINT + '/music').then(r => r.json());

			if (res.kind == 'ok') {
				render(target, res.tracks);
			} else {
				target.innerHTML = 'Oops, something went wrong. This is embarrassing…';
				console.warn(res.message);
			}
		} catch (err) {
			console.error(err);
		} finally {
			loading.textContent = original;
		}
	}
</script>
