<!DOCTYPE html>
<html lang="en-gb" class=" writingssublime-text-deno"><head itemtype="http://schema.org/Blog" itemscope="">
    <title>Setting up Sublime Text for Deno / Johan</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="preconnect" href="https://gc.zgo.at">
    <link rel="preconnect" href="https://johanbrook.goatcounter.com">

    
    <meta name="description" content="How I set up Sublime Text 4 for developing Deno code.">
    
    
    <meta name="keywords" content="deno,sublime text,plugins,config,extensions,lsp">
    
    <meta name="author" content="Johan Brook">

    <!-- Styles-->
    <link rel="stylesheet" href="/johan.css">

    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" title="Johan Brook: Posts feed (Atom)" href="/writings.xml">
    <link rel="alternate" type="application/atom+xml" title="Johan Brook: Micro feed (Atom)" href="/micro.xml">
    <link rel="alternate" type="application/feed+json" title="Johan Brook: Micro feed (JSON)" href="/micro.json">
    <link rel="alternate" type="application/atom+xml" title="Johan Brook: Book feed (Atom)" href="/reading.xml">

    <link rel="shortcut icon" href="/favicon.png" type="image/png">
    <link rel="canonical" itemprop="url" href="https://johan.im/writings/sublime-text-deno/">
    <link rel="author" href="https://johan.im">
    <link rel="me" href="https://hachyderm.io/@brookie">

    <meta property="og:title" content="Setting up Sublime Text for Deno">
    <meta property="og:url" content="https://johan.im/writings/sublime-text-deno/">
    <meta property="og:site_name" itemprop="name" content="Johan Brook">
    
    <meta property="og:locale" content="en_GB">
    
    <meta property="og:description" content="How I set up Sublime Text 4 for developing Deno code.">
    

    

    
	<meta property="og:type" content="article">
    <meta property="article:tag" content="deno,sublime text,plugins,config,extensions,lsp">
    <meta property="article:published_time" content="2022-02-16T01:00:00+01:00">
   	
  </head>

  <body>
  	  <a href="#main" class="visually-hidden skip-link">Skip to content</a>

	  <div class="Content">

		

<nav role="navigation" class="MobileNav">
    <p class="mb0">
        <a aria-label="Home" class="plain" href="/">Johan</a> <span class="faint">/</span> <a href="/writings" class="muted">Writings</a>
    </p>
</nav>


		<div id="main">
			<main role="main">
  <article class="Post" role="article" itemscope="" itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 itemprop="name" class="title">Setting up Sublime Text for Deno</h1>

      <p class="mb0 fw5">
          <time class="text-color-contrast" datetime="2022-02-16T01:00:00+01:00" title="Wednesday, 16 February 2022 at 01:00:00 Central European Time" itemprop="datePublished" pubdate="">
            February 16, 2022
          </time>
          
          
      </p>

      <p class="f5 mb4 font-sans muted">
          About 4 min reading time
      </p>
    </header>

    <div class="prose" itemprop="articleBody">
      
      <p>I’ve recently switched back to Sublime Text as main editor, as described in a recent
<a href="/micro/202202080950">/micro post</a>. As a test to get a feel for the ecosystem, I’ve set out on a
journey to make it more ergonomic to develop <a href="https://deno.land">Deno</a> code. “Ergonomic” as in
“actually use Typescript features and not show any red compile errors for Deno specific code”. Also,
I want to try to have Sublime support
<a href="https://deno.land/manual/linking_to_external_code/import_maps">import maps</a>,
<a href="https://deno.land/manual/getting_started/configuration_file">the Deno config file</a>, and format on
save.</p>
<h1>Install necessary packages</h1>
<p>(I assume you have <a href="https://packagecontrol.io/installation">Package Control up and running</a>.)</p>
<p><strong>Required:</strong></p>
<ul>
<li><a href="https://packagecontrol.io/packages/LSP">LSP</a>. Client implementation of the Language Server
Protocol for Sublime Text. This is a base package, which is used by other language specific
packages. There are packages for Typescript, CSS, Deno, JSON, Lua, Vue, etc. etc.</li>
<li><a href="https://packagecontrol.io/packages/LSP-Deno">LSP-Deno</a>. Convenience package for starting the Deno
LSP server. This enables Deno features in Sublime.</li>
</ul>
<p><strong>Optional:</strong></p>
<ul>
<li><a href="https://packagecontrol.io/packages/LSP-json">LSP-json</a>. Schema validation/completions for your
JSON and Sublime files. This is for making JSON files more “VS Code like” in the way that keys in
various settings files can be autocompleted and validated. Handy but in no way required.</li>
</ul>
<h2>Sublime project configuration</h2>
<p>First of all, we need a place where we can instruct Sublime (and installed packages) where to look
for custom Deno settings. That is, settings that describe paths to files, and lint and format
config. Essentially holding the values described in
<a href="https://deno.land/manual/getting_started/configuration_file">“Configuration file”</a>.</p>
<p>These will go into a <code>xxx.sublime-project</code> file, where <code>xxx</code> is the name of your project (anything).
Create one if you haven’t.</p>
<hr>
<p>(Sublime has this concept of “projects” I don’t really like. One has to go to <em>Window -&gt; Open
project…</em> in order for the editor to actually load the project config file, <em>or</em> use
<code>subl --project path/to/project.sublime-project</code>. It’s not loaded when the editor is brought up via
<code>subl .</code> from the command line. This feels lame. Sort of
<a href="https://github.com/sublimehq/sublime_text/issues/828">tracked here</a>.)</p>
<hr>
<p>This is a sample <code>xxx.sublime-project</code> for Deno:</p>
<pre><code class="language-json">{
    "settings": {
        "LSP": {
            "LSP-typescript": {
                "enabled": false
            },
            "Deno": {
                "enabled": true,
                "settings": {
                    "deno.config": "./deno.jsonc",
                    "deno.unstable": true,
                    "deno.importMap": "./import_map.json",
                    "deno.suggest.imports.hosts": {
                        "https://deno.land": true,
                        "https://some-other-cdn.com": true
                    }
                }
            }
        }
    }
}
</code></pre>
<p>All <code>deno.*</code> settings are documented
<a href="https://github.com/sublimelsp/LSP-Deno/blob/main/LSP-Deno.sublime-settings">here, with defaults</a>.</p>
<p>Line by line:</p>
<ul>
<li><code>LSP-typescript</code>. Let’s be really sure to disable the TypeScript Language Server, since that’ll
interfere with <code>.ts</code> files with Deno calls.</li>
<li><code>deno.config</code>: Path to the Deno
<a href="https://deno.land/manual/getting_started/configuration_file">configuration file</a>.</li>
<li><code>deno.unstable</code>: Enable unstable features or not.</li>
<li><code>deno.importMap</code>: Path to an <a href="https://deno.land/manual/npm_nodejs/import_maps">import map</a>.</li>
<li><code>deno.suggest.imports.hosts</code>: Hosts that will appear as suggestions when importing.</li>
</ul>
<p>(As mentioned above, the LSP-json package really helps you with the autocomplete here. I found it
tricky to figure out the exact structure of these settings.)</p>
<p>For me, there’s no need to do further tweaks in most Deno projects.</p>
<p>Now, Sublime should be able to pick up your import map, as well as your Deno configuration.</p>
<p>If configured correctly, you should be able to</p>
<ul>
<li>get IntelliSense popups when hovering over functions</li>
<li>have working import maps</li>
<li>get proper type info and autocompletions when coding</li>
<li>have correct <code>compilerOptions</code> from your Deno config</li>
</ul>
<p>and lots more.</p>
<p><img src="/assets/posts/deno-intellisense.png" alt="IntelliSense documentation popup"></p>
<hr>
<p><strong>Note:</strong> at the time of writing, there’s an issue with the <code>deno.suggest.imports.hosts</code> key. If you
toggle the LSP log panel (<em>Command palette -&gt; “LSP: Toggle log panel”</em>), you’ll see that it says:</p>
<pre><code>failed to update settings: invalid type: map, expected a boolean
</code></pre>
<p>I’ve filed an <a href="https://github.com/sublimelsp/LSP-Deno/issues/10">issue for LSP-Deno here</a>. I’ve
noticed that this setting interfers with the other settings, so I’ve removed it for now.</p>
<h2>Click to go to definition</h2>
<p>This is a feature I heavily used in VS Code: use the combo of <code>option+click</code> (Mac) to go to the
definition of a variable, function, or type. This uses the LSP, so it’ll be “intelligent”.</p>
<p>Mouse bindings live in this file (create it if it doesn’t exist):</p>
<pre><code>~/Library/Application\ Support/Sublime\ Text/Packages/User/Default\ (OSX).sublime-mousemap
</code></pre>
<p>Then add this:</p>
<pre><code class="language-json">[
    {
        "button": "button1",
        "count": 1,
        "modifiers": [
            "alt"
        ],
        "press_command": "lsp_symbol_definition"
    }
]
</code></pre>
<p>You can now use <code>alt+click</code> to jump around.</p>
<h2>Rename symbols</h2>
<p>Another nifty feature we can use the Language Server’s capabilities for is to do smart renames, i.e.
rename functions and variables and have them be intelligently updated across files.</p>
<p>In VS Code, I used the key binding <code>cmd+shift+r</code> (Mac).</p>
<p>Open up Key Bindings (<em>Preferences -&gt; Key Bindings</em>) or:</p>
<pre><code class="language-bash">subl ~/Library/Application\ Support/Sublime\ Text/Packages/User/Default\ (OSX).sublime-keymap
</code></pre>
<p>Then add this:</p>
<pre><code class="language-json">[
    {
        "keys": ["super+shift+r"],
        "command": "lsp_symbol_rename",
        "context": [
            {
                "key": "lsp.session_with_capability",
                "operator": "equal",
                "operand": "renameProvider"
            }
        ]
    }
]
</code></pre>
<h2>Diagnostics panel</h2>
<p>By default, the LSP package will show a diagnostics panel if there are TypeScript errors or warnings
in your project. I found this really annoying, so I turned it off with:</p>
<p><em>Preferences -&gt; Package Settings -&gt; LSP -&gt; Settings</em></p>
<p>Then add:</p>
<pre><code class="language-json">{
    // Open the diagnostics panel automatically on save when diagnostics level is
    // equal to or less than:
    // none: 0 (never open the panel automatically)
    // error: 1
    // warning: 2
    // info: 3
    // hint: 4
    "show_diagnostics_panel_on_save": 0 // default is 2, turn off with 0
}
</code></pre>
<p><strong>Tip:</strong> You can still toggle the <em>Diagnostics</em> panel with <code>cmd+alt+m</code> (Mac) or search for it in the
command palette. It’ll show any TypeScript errors or warnings in the project.</p>
<h2>Code formatting</h2>
<p>Deno comes with a built-in formatter, which the LSP in Sublime can use.</p>
<p>Either run <code>LSP: Format file</code> from the command palette to format manually, or use format on save.
The latter is configured in the LSP settings, <em>but</em> you should probably do it on a project basis.
This means adding this to your Sublime project file:</p>
<pre><code class="language-json">{
    "settings": {
        "lsp_format_on_save": true
    }
}
</code></pre>
<p>The exact formatting config lives in your Deno configuration. For me, it’s <code>deno.jsonc</code>:</p>
<pre><code class="language-json">{
    "fmt": {
        "options": {
            "useTabs": false,
            "lineWidth": 100,
            "singleQuote": true,
            "indentWidth": 4
        }
    }
}
</code></pre>
<h2>Bonus: JSON schema support for <code>deno.json</code></h2>
<p>There’s no built-in support for autocompletions in <code>deno.{json,jsonc}</code> files. But with our newly
installed LSP-json package, there is a way! Deno publishes its schema for the config file on a URL,
which we can add to “user schemas” in the LSP-json settings.</p>
<p>Open <code>LSP-json.sublime-settings</code> or run <code>LSP-json Settings</code> in the command palette. Then add this:</p>
<pre><code class="language-json">{
    "settings": {
        "userSchemas": [
            {
                "fileMatch": ["deno.json", "deno.jsonc"],
                "uri": "https://deno.land/x/deno@v1.18.2/cli/schemas/config-file.v1.json"
            }
        ]
    }
}
</code></pre>
<p>I guess one has to update the versions in there manually, but the package wouldn’t follow the URL
linked from Deno’s
<a href="https://deno.land/manual/getting_started/configuration_file">documentation page</a>, probably since it
redirects:
<a href="https://deno.land/x/deno/cli/schemas/config-file.v1.json">https://deno.land/x/deno/cli/schemas/config-file.v1.json</a>.</p>
<hr>
<p>That’s it! <a href="/contact">Let me know</a> if you’ve got more tricks for working with Deno in Sublime.</p>

    </div>
  </article>
</main>

		</div>

   		<nav role="navigation" class="MainNav">
	<div class="sticky">
		<h1 class="f4 font-sans">
			<a href="/" aria-label="Home">
				<span>Johan</span><span aria-hidden="true" class="BackLink ml2">←</span>
			</a>
		</h1>

		<ul role="list">
          		<li>
         			<a href="/now/">Now</a>
          		</li>
          		<li>
         			<a href="/micro/">Micro</a>
          		</li>
          		<li>
         			<a href="/about/">About</a>
          		</li>
          		<li>
         			<a href="/reading/">Reading</a>
          		</li>
          		<li aria-current="page">
         			<a href="/writings/">Writings</a>
          		</li>
          		<li>
         			<a href="/feeds/">Feeds</a>
          		</li>
            <li>
     			<a href="/all">All pages</a>
      		</li>
        </ul>
	</div>
</nav>

	  </div>

      <script>
  // Only load on production environment.
  if (window.location.host !== new URL('https://johan.im').host) {
    window.goatcounter = {no_onload: true};
  }

  // Skip own views
  if (window.location.hash === '#skipgc')
    localStorage.setItem('skipgc', 't');
  if (localStorage.getItem('skipgc') === 't')
    window.goatcounter = {no_onload: true};
</script>
<script data-goatcounter="https://johanbrook.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>

  


</body></html>