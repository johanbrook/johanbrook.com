<!doctype html><html class=writingsadding-custom-url-endpoints-in-wordpress lang=en><head itemscope itemtype=http://schema.org/Blog><title>Adding custom URL endpoints in Wordpress / Johan Brook</title><meta charset=utf-8><meta content="width=device-width,initial-scale=1"name=viewport><link href=https://gc.zgo.at rel=preconnect><link href=https://johanbrook.goatcounter.com rel=preconnect><meta content="I'm a thirty-something designer and developer based in Sweden. I work with the best people in a company called Lookback, where I help interfaces come to life. I'm coding & designering and I like working with product, user experience, interface design, and other things too."name=description><meta content=Custom,PHP,URL,Wordpress,endpoint,rewrite,template name=keywords><meta content="Johan Brook"name=author><link href=/johan.css rel=stylesheet><link title="Johan Brook: Posts feed"href=/feed.xml rel=alternate type=application/rss+xml><link title="Johan Brook: Mind feed"href=/mind.xml rel=alternate type=application/rss+xml><link title="Johan Brook: Book feed"href=/reading.xml rel=alternate type=application/rss+xml><link rel="shortcut icon"href=/favicon.png type=image/png><link href=https://johan.im/writings/adding-custom-url-endpoints-in-wordpress/ itemprop=url rel=canonical><link href=https://johan.im rel=author><meta content="Adding custom URL endpoints in Wordpress"property=og:title><meta content=https://johan.im/writings/adding-custom-url-endpoints-in-wordpress/ property=og:url><meta content="Johan Brook"itemprop=name property=og:site_name><meta content=en_GB property=og:locale><meta content="I'm a thirty-something designer and developer based in Sweden. I work with the best people in a company called Lookback, where I help interfaces come to life. I'm coding & designering and I like working with product, user experience, interface design, and other things too."property=og:description><meta content=article property=og:type><meta content=Custom,PHP,URL,Wordpress,endpoint,rewrite,template property=article:tag><meta content=2012-01-13T00:00:00Z property=article:published_time><body><a class="visually-hidden skip-link"href=#main>Skip to content</a><div class=Content><div id=main><main role=main><article class=Post itemscope itemtype=http://schema.org/BlogPosting role=article><header><h1 class=title itemprop=name>Adding custom URL endpoints in Wordpress</h1><p class="mb0 fw5 mt3"><time datetime=2012-01-13T00:00:00Z itemprop=datePublished pubdate> January 13th, 2012 </time><p class="f5 mb4">About 2 min reading time</header><div class="prose drop-cap"itemprop=articleBody><p>In a current Wordpress project, we wanted to have a permalink to a photo gallery filled with images (attachments) for a post. Wordpress supports permalinks to single attachments, such as<pre><code>site.com/single-post/attachment/flower
</code></pre><p>That’s cool. However, we wanted something like this:<pre><code>site.com/single-post/photos
</code></pre><p>… where all attachments would be listed. The <code>/photos</code> part is called an <em>endpoint</em>. So how do you add them in Wordpress? And how do you assign this endpoint to render a specific template file?<h2>Relevant APIs</h2><p>After some quick googling to find out if this was possible and worth a try, I found the <a href=http://codex.wordpress.org/Rewrite_API>Rewrite API</a> in the Codex. Neat stuff.<p>Other resources I found during my quest:<ul><li><a href=http://johnbeales.com/20090824/endpoints-a-little-secret-for-url-manipulation-in-wordpress/>http://johnbeales.com/20090824/endpoints-a-little-secret-for-url-manipulation-in-wordpress/</a><li><a href=http://wordpress.org/support/topic/custom-rewrite-approach-with-add_rewrite_endpoint>http://wordpress.org/support/topic/custom-rewrite-approach-with-add_rewrite_endpoint</a><li><a href=http://www.rlmseo.com/blog/passing-get-query-string-parameters-in-wordpress-url/>http://www.rlmseo.com/blog/passing-get-query-string-parameters-in-wordpress-url/</a><li><a href=http://wordpress.stackexchange.com/questions/1033/url-design-for-sub-posts>URL Design for Sub-Posts?</a><li><a href=http://codex.wordpress.org/Template_Hierarchy>http://codex.wordpress.org/Template_Hierarchy</a></ul><h2>The code</h2><p>After reading through these, I simply implemented the necessary filters and callbacks in the <code>functions.php</code> file.<p>I began with this:<pre><code>add_filter( 'query_vars', 'add_query_vars');

/**
*   Add the 'photos' query variable so Wordpress
*   won't mangle it.
*/
function add_query_vars($vars){
    $vars[] = "photos";
    return $vars;
}
</code></pre><p>As you can see, I’m working with my <code>/photos</code> endpoint. I have to tell Wordpress’ rewrite engine to take our special query variable (“photos”) into account when rewriting URLs, so I used the <code>query_vars</code> filter for this (see the <a href=http://codex.wordpress.org/Plugin_API/Filter_Reference>Filter Reference</a>).<p>Next, I registered the actual endpoint with the built-in function <code>add_rewrite_endpoint()</code> ( <a href=http://codex.wordpress.org/Rewrite_API/add_rewrite_endpoint>Docs</a>). It takes a string (the endpoint) and a <code>place</code> . “Place” is where the endpoint will be active, and the docs only specify a couple: “EP_PERMALINK, EP_PAGES, EP_ATTACHMENT, etc”. From other examples I’ve spotted <code>EP_ALL</code> as well. I used <code>EP_PERMALINK</code> :<pre><code>add_rewrite_endpoint('photos', EP_PERMALINK);
</code></pre><p>Right. The endpoint is up and running, but as I said at the top, I wanted a specific template to render when this URL is visited. It’s doable! Check out the <a href=http://codex.wordpress.org/Plugin_API/Filter_Reference/_single_template>single_template filter</a>.<pre><code>add_filter( 'single_template', 'project_attachments_template' );

/**
*	From http://codex.wordpress.org/Template_Hierarchy
*
*	Adds a custom template to the query queue.
*/
function project_attachments_template($templates = ""){
	global $wp_query;
	
	// If the 'photos' endpoint isn't appended to the URL,
	// don't do anything and return
	if(!isset( $wp_query->query['photos'] ))
		return $templates;
	
	// .. otherwise, go ahead and add the 'photos.php' template
	// instead of 'single-{$type}.php'.
	if(!is_array($templates) && !empty($templates)) {
		$templates = locate_template(array("photos.php", $templates),false);
	} 
	elseif(empty($templates)) {
		$templates = locate_template("photos.php",false);
	}
	else {
		$new_template = locate_template(array("photos.php"));
		if(!empty($new_template)) array_unshift($templates,$new_template);
	}
	

	return $templates;
}
</code></pre><p>I’ve hard coded the file <code>photos.php</code> above. Create this file in the theme folder, and you’re all set! In this template you’ve got access to the global <code>$post</code> variable, so you’re able to pull in all kinds of post data into it.<h2>Outro</h2><p>Pretty cool to bend Wordpress to your will, eh? I can imagine this functionality is pretty nifty to have when doing more advanced things in Wordpress.</div></article></main><footer class=mb3 role=contentinfo><nav><ul class=mb3><li><a href=/>Home</a><li><a href=mailto:webmaster@johan.im rel=me>Email</a><li><a href=https://hachyderm.io/@brookie rel=me>Mastodon</a><li><a href=/feed.xml title=Atom>Post feed</a><li><a href=/mind.xml title=Atom>Mind feed</a><li><a href=/reading.xml title=Atom>Reading feed</a></ul></nav></footer></div><nav class=MainNav role=navigation><div class=sticky><h1 class="f4 sr-only-mobile"><a aria-label=Home href=/> <span>Johan Brook</span><span class="BackLink ml2"aria-hidden=true>←</span> </a></h1><ul class=NavCommon><li class=only-mobile><a href=/>Home</a><li><a href=/writings/>Writings</a><li><a href=/mind/>On my mind</a><li><a href=/now/>Now</a><li><a href=/reading/>Reading</a><li><a href=/about/>About me</a><li><a href=/to-read/>To read</a><li><a href=/quotes/>Quotes</a><li><a href=/changelog/>Changelog</a><li><a href=/credits/>Credits</a></ul></div></nav></div><script>if(window.location.host!==new URL('https://johan.im').host){window.goatcounter={no_onload:true}};if(window.location.hash==='#skipgc')localStorage.setItem('skipgc','t');if(localStorage.getItem('skipgc')==='t')window.goatcounter={no_onload:true}</script><script async data-goatcounter=https://johanbrook.goatcounter.com/count src=//gc.zgo.at/count.js></script>