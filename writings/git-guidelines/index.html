<!DOCTYPE html>
<html lang="en-gb" class=" writingsgit-guidelines"><head itemtype="http://schema.org/Blog" itemscope="">
    <title>Recent improvements in our git discipline / Johan</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="preconnect" href="https://gc.zgo.at">
    <link rel="preconnect" href="https://johanbrook.goatcounter.com">

    <meta name="generator" content="Lume">

    
    <meta name="description" content="The git history of a repository a few years in or with more than one collaborator will look like thick weed unless you take care of it. During last Autumn in Lookback, the engineering team noticed that we needed to take care of some weeds.">
    
    
    <meta name="author" content="Johan Brook">

    <!-- Styles-->
    
        <link rel="stylesheet" href="/johan.css">
    

    <!-- Feeds -->
    <link rel="alternate" type="application/rss+xml" title="Johan Brook: Posts feed (RSS)" href="/writings.xml">
    <link rel="alternate" type="application/feed+json" title="Johan Brook: Posts feed (JSON)" href="/writings.json">
    <link rel="alternate" type="application/rss+xml" title="Johan Brook: Micro feed (RSS)" href="/micro.xml">
    <link rel="alternate" type="application/feed+json" title="Johan Brook: Micro feed (JSON)" href="/micro.json">
    <link rel="alternate" type="application/rss+xml" title="Johan Brook: Book feed (RSS)" href="/reading.xml">
    <link rel="alternate" type="application/feed+json" title="Johan Brook: Book feed (JSON)" href="/reading.json">
    <link rel="alternate" type="application/rss+xml" title="Johan Brook: Recipes feed (RSS)" href="/recipes.xml">
    <link rel="alternate" type="application/feed+json" title="Johan Brook: Recipes feed (JSON)" href="/recipes.json">

    <link rel="shortcut icon" href="/favicon.png" type="image/png">
    <link rel="canonical" itemprop="url" href="https://johan.im/writings/git-guidelines/">
    <link rel="author" href="https://johan.im">
    <link rel="me" href="https://hachyderm.io/@brookie">

    <meta property="og:title" content="Recent improvements in our git discipline">
    <meta property="og:url" content="https://johan.im/writings/git-guidelines/">
    <meta property="og:site_name" itemprop="name" content="Johan Brook">
    
    <meta property="og:locale" content="en_GB">
    
    <meta property="og:description" content="The git history of a repository a few years in or with more than one collaborator will look like thick weed unless you take care of it. During last Autumn in Lookback, the engineering team noticed that we needed to take care of some weeds.">
    

    

    
	<meta property="og:type" content="article">
    <meta property="article:tag" content="">
    <meta property="article:published_time" content="2020-02-23T01:00:00+01:00">
   	
  </head>

  <body>
  	  <a href="#main" class="visually-hidden skip-link">Skip to content</a>

     

	  <div class="Content">

		

<nav role="navigation" class="MobileNav">
    <p class="mb0">
        <a aria-label="Home" class="MobileNav__Home plain" href="/">Johan</a> <span class="faint">/</span> <a href="/writings" class="muted">Writings</a>
    </p>
    <div class="relative">
        <details>
            <summary>Menu</summary>
            <ul role="list" class="NavList">
              		<li>
             			<a href="/micro/">Micro</a>
              		</li>
              		<li>
             			<a href="/now/">Now</a>
              		</li>
              		<li>
             			<a href="/reading/">Reading</a>
              		</li>
              		<li>
             			<a href="/about/">About</a>
              		</li>
              		<li aria-current="page">
             			<a href="/writings/">Writings</a>
              		</li>
              		<li>
             			<a href="/recipes/">Recipes</a>
              		</li>
              		<li>
             			<a href="/feeds/">Feeds</a>
              		</li>
                <li>
         			<a href="/all">All pages</a>
          		</li>
            </ul>
        </details>
    </div>
</nav>


		<div id="main">
			<main role="main">
  <article class="Post" role="article" itemscope="" itemtype="http://schema.org/BlogPosting">
    <header class="mb4">
      <h1 itemprop="name" class="title">Recent improvements in our git discipline</h1>

      <p class="mb1 fw5">
          <time class="text-color-contrast" datetime="2020-02-23T01:00:00+01:00" title="Sunday, 23 February 2020 at 01:00:00 Central European Time" itemprop="datePublished" pubdate="">
            February 23, 2020
          </time>
          
          
      </p>

      <p class="f5 mb0 font-sans muted">
        About 6 min reading time
      </p>

      
        <ul role="list" class="mb0 f6">
            
            <li class="muted font-sans inline">#dev</li>
            
            <li class="muted font-sans inline">#git</li>
            
        </ul>
      
    </header>

    <div class="prose" itemprop="articleBody">
      
      <p>The git history of a repository a few years in or with more than one collaborator will look like
thick weed unless you take care of it. During last Autumn in <a href="http://lookback.io">Lookback</a>, the
engineering team noticed that we needed to take care of some weeds.</p>
<p>Not only in our committing code culture, but also in the land of code reviews and Pull Requests at
GitHub.</p>
<p>Here are some of the principles and guidelines we worked out.</p>
<h1>Empathy for others and your future self</h1>
<p>We say:</p>
<blockquote>
<p>‚ÄúPlease have empathy for your coworkers when committing code. Be considerate of them as well as
your future self‚Äù.</p>
</blockquote>
<p>When working in a long living code base with lots of complex and moving parts, bugs can surface
weeks or months after you wrote the code. Guess what system helps you go back in time and find
exactly what, when, and who changed a line of code?! git can! Guess what doesn‚Äôt help git help you?
These things:</p>
<ul>
<li>Unclear commit messages.</li>
<li>Incoherent and too large commits.</li>
<li>Not easily revertable commits (connected with the above).</li>
<li>Merge commits.</li>
</ul>
<p>Failure to avoid these things will bite you when debugging something in the future.</p>
<p>For us, we didn‚Äôt enforce or point these things out in code reviews either. One person could file a
Pull Request 10+ commits, where some of them wouldn‚Äôt even be related to the PR itself. It was hard
to give good feedback on a commit which said <code>fix some things in logging</code>: what did you fix? Why?</p>
<p>‚ÄúYou‚Äôve got to give love to receive love‚Äù. Meaning, ‚Äúyou‚Äôve got to give your co-workers good PRs in
order to receive good feedback‚Äù. A related joke is the old ‚Äú20 commit PR? LGTM. One commit? A
novella of feedback‚Äù.</p>
<p>We decided to reboot our engineering culture around clean commits and PRs. What follows are some of
the guidelines we drafted for working with code.</p>
<hr>
<h1>1. Committing code</h1>
<p>Make each commit <strong>atomical</strong>. That is, make it include only the relevant code for your intended
change. There‚Äôs a lot to read about this subject on the web.</p>
<p>When submitting a patch for code review, consider grouping together similar commits with
<code>git rebase</code>(‚Äúsquashing‚Äù) to keep commit count down (<em>without</em> breaking the rule about atomical
commits above!).</p>
<p>The <code>master</code> branch‚Äôs history should ideally be a long string of commits. We should avoid merge
commits by rebasing in <code>master</code> into your feature branch before merging back.</p>
<h2>Commit messages</h2>
<ul>
<li>Try to focus on the <em>why</em> in commit messages. Not necessarily <em>what</em>. Think about how this commit
will be read when doing a <code>git blame</code> half a year later. The reader is probably interested in
<em>why</em> this change happened.</li>
<li>Capturing the <em>why</em> context is super important, since it‚Äôs probably tricky to recover later. Save
yourself some future slack and capture the why <em>now</em>.</li>
<li>Adding any references (external stories, cards, etc) is appreciated.</li>
</ul>
<p><a href="https://chris.beams.io/posts/git-commit/">‚ÄúHow to Write a Git Commit Message‚Äù</a> includes some no
brainer guidelines for good commit messages.</p>
<h1>2. Submitting Pull Requests</h1>
<p><strong>Have mercy for your coworkers.</strong> Don‚Äôt dump an unstructured, large PR on them with ‚ÄúReview
this!!‚Äù. Be considerate of their time and energy when submitting, as it might be very hard for them
to get into the context you‚Äôve been into the last couple of days while working on the code.</p>
<p>Make all PRs minimal, concise, and relevant. Don‚Äôt include non-trivial refactors of modules in a PR
that‚Äôs really supposed to do something else.</p>
<p>Avoid long living branches. By making small, incremental changes, we avoid messy merge conflicts and
best of all: we avoid risky deploys. It‚Äôs easier to reason about small patches, and potentially
rolling them back, than huge blobs of ‚Äúfix everything‚Äù PRs.</p>
<p>Make sure your PR is rebased on <code>master</code> when submitting it. That removes the need for merge commits
when merging back to <code>master</code>.</p>
<p>When your PR is ready for review (implies that you also think it‚Äôs ready for merge), <strong>you must make
sure it‚Äôs neat and tidy</strong>.</p>
<ul>
<li>Squash any similar commits together.</li>
<li>Look at each commit and see if it makes sense: does it have a nice message? Is the code changes
relevant and atomical? If a coworker does a <code>git log</code> in two months, will they be able to
understand this change?</li>
</ul>
<p>After receiving a code review with change requests, always try to squash those changes together with
the initial commits made when first submitting the PR. It‚Äôs okay if you have lots of smaller commits
in your feature branch <em>while working</em> with the code. But once it‚Äôs ready for review and later merge
into <code>master</code>, the final PR <em>must</em> be in a concise, minimal state.</p>
<p>The code reviewer may reject your PR if it‚Äôs:</p>
<ul>
<li>Too large (‚Äúplease break into separate PRs‚Äù).</li>
<li>Unstructured/needs squashing (‚Äúplease restructure this PR‚Äù, ‚Äúplease redo your commit history‚Äù).</li>
</ul>
<p>This does <strong><em>not</em></strong> mean ‚Äúyou suck‚Äù. It‚Äôs a signal that you can learn how to avoid this the next
time, as well as avoding wasting your coworkers‚Äô time. We aim to learn and become a better developer
(and co-developer!) with code reviews, since it‚Äôs so easy to do your own thing when you‚Äôve been down
in a code cave for a couple of days.</p>
<h1>3. Tools &amp; patterns</h1>
<p>When rebasing your branch‚Äâ‚Äî‚Äâeither to rebase in <code>master</code> or rewrite history‚Äâ‚Äî‚Äâthe branch will be
diverging from the remote, if you‚Äôve pushed it already. So you need to force push next time
(<code>git push -f</code>).</p>
<h2>Commit message templates</h2>
<p>I just learned about this a couple of months ago: git supports <strong>message templates.</strong> Every time
you‚Äôre committing something from an external editor (not from the command line), you can use a
pre-written template. The template I stole from the post linked below reminds me of the ‚ÄúBecause‚Äù.
Why are you even doing this commit? Any business purpose, or is it tech?</p>
<pre><code>[one line-summary of changes]

Because:
- [relevant context]
- [why you decided to change things]
- [reason you're doing it now]

This commit:
- [does X]
- [does Y]
- [does Z]
</code></pre>
<p><a href="https://thoughtbot.com/blog/better-commit-messages-with-a-gitmessage-template">Read more about setting this template up</a>.</p>
<h2>Rebasing</h2>
<p>See this guide from the git docs:
<a href="https://git-scm.com/book/en/v2/Git-Branching-Rebasing">‚ÄúRebasing‚Äù</a>.</p>
<p>For instance:</p>
<pre><code class="language-bash">git checkout my-feature-branch
# ...do work
# ...changes have been made in remote master
# fetch/pull latest master
git rebase master
</code></pre>
<p>This will re-apply your commits in the feature branch on top of what‚Äôs in <code>master</code>&nbsp;, to make it
appear as your branch is branched off of latest commit in <code>master</code>.</p>
<p>üí°<strong>Tip:</strong> use <code>git fetch origin master:master</code> from your feature branch to fetch latest <code>master</code>
without leaving your branch.</p>
<p>There‚Äôs a ton of magic things one can do with <code>rebase</code>, please consult the internet or ask coworkers
about rebasing strategies.</p>
<ul>
<li><strong>Do</strong> rebase <code>master</code> into your feature branch when there are upstream changes in <code>master</code>.</li>
<li><strong>Don‚Äôt</strong> use <code>git merge</code> when including changes from <code>master</code> to your feature branch.</li>
</ul>
<h2>Conflicts</h2>
<p>At some point, there will be conflicts when rebasing. You‚Äôll be able to solve them in the same way
as when manually solving conflicts when doing <code>git merge</code>. This is all described in the terminal
when there‚Äôs a conflict. In a nutshell</p>
<pre><code class="language-bash"># Find conflicts in code:
git status
# ..Fix them :)
# Mark as resolved:
git add &lt;file&gt;
# Continue rebasing
git rebase --continue
</code></pre>
<h2>Force pushing to collaborative branches</h2>
<p>Rewriting history requires you to force push the PR branch. I.e. you need to push with <code>git push -f</code></p>
<p>The problem with force pushing is that anyone collaborating on the branch will not be able to just
<code>git pull</code>. However, git introduced a switch on <code>pull</code> which fixes this:</p>
<pre><code class="language-bash">git pull --rebase
</code></pre>
<p>This is essentially a</p>
<pre><code class="language-bash">git fetch origin
git rebase origin/&lt;your-branch&gt;
</code></pre>
<h2>Squashing commits together</h2>
<p>This is nice for when you‚Äôve done a lot of small, work preserving commits (WIPs or just to not lose
them) that need to be ‚Äúbeautified‚Äù before submitting for review.</p>
<p>See this guide from the git docs:
<a href="https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History">‚ÄúRewriting History‚Äù</a>.</p>
<p>In a nutshell:</p>
<pre><code class="language-bash"># -i is for "interactive"
# git rebase -i &lt;git reference&gt;
# HEAD~&lt;number of commits to include in rebase&gt;
git rebase -i HEAD~5
# or
git rebase -i git-hash^ # ^ is targetting the parent commit
</code></pre>
<p>An editor will open with your included commits listed. There‚Äôll be a legend below them describing
how to rewrite history. You can drop commits (<code>d</code>), squash together commits (<code>s</code>), and more. You‚Äôll
be able to rewrite the commits messages too.</p>
<h1>Aftermath</h1>
<p>After we introduced some baselines in how we commit and share code, I personally felt much more
motivated to keep things neat and tidy (aka.
<a href="https://en.wikipedia.org/wiki/Broken_windows_theory">‚ÄúBroken window syndrome‚Äù</a>). Git isn‚Äôt just a
tool to transport code from your laptop to a server: it‚Äôs a super cool tool created to help us
collaborate better, <em>and</em> to fix stuff when things go bad (which <em>will</em> happen sometime).</p>
<p>I found myself actually enjoying writing extended paragraphs in my commit messages. It brought back
some memories in doing <a href="https://en.wikipedia.org/wiki/Literate_programming">literate programming</a> in
CoffeeScript for university lab assignments. The shorter the commit diff, the longer my commit
message would be‚Äâ‚Äî‚Äâa funny inverse proportional property!</p>
<p>It also touches me every time I go back and see somebody had put in some effort in the commit
message, and documented the process, the Why, and the outcome. It‚Äôs like a time machine in your
colleagues‚Äô minds, and also in their personal development to become better programmers.</p>

    </div>
  </article>
</main>

		</div>

   		<nav role="navigation" class="MainNav">
	<div class="sticky">
		<h1 class="f4 font-sans">
			<a href="/" aria-label="Home">
				<span>Johan</span><span aria-hidden="true" class="BackLink ml2">‚Üê</span>
			</a>
		</h1>

		<ul role="list" class="NavList">
          		<li>
         			<a href="/micro/">Micro</a>
          		</li>
          		<li>
         			<a href="/now/">Now</a>
          		</li>
          		<li>
         			<a href="/reading/">Reading</a>
          		</li>
          		<li>
         			<a href="/about/">About</a>
          		</li>
          		<li aria-current="page">
         			<a href="/writings/">Writings</a>
          		</li>
          		<li>
         			<a href="/recipes/">Recipes</a>
          		</li>
          		<li>
         			<a href="/feeds/">Feeds</a>
          		</li>
            <li>
     			<a href="/all">All pages</a>
      		</li>
        </ul>
	</div>
</nav>

	  </div>

      <script>
  // Only load on production environment.
  if (window.location.host !== new URL('https://johan.im').host) {
    window.goatcounter = {no_onload: true};
  }

  // Skip own views
  if (window.location.hash === '#skipgc')
    localStorage.setItem('skipgc', 't');
  if (localStorage.getItem('skipgc') === 't')
    window.goatcounter = {no_onload: true};
</script>
<script data-goatcounter="https://johanbrook.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>

  


</body></html>